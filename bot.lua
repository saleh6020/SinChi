bot = dofile('utils.lua')json = dofile('json.lua')sudos = dofile('sudo.lua')URL = require "socket.url"serpent = require("serpent")http = require "socket.http"https = require "ssl.https"redis = require('redis')db = redis.connect('127.0.0.1', 6379) bot_id=0 function vardump(value) print(serpent.block(value, {comment=false})) end function dl_cb(arg, data) end function is_sudo(msg) local var = false for v,user in pairs(sudo) do if user == msg.sender_user_id_ or db:sismember('mods'..bot_id,msg.sender_user_id_) then var = true end end return var end function run(msg,data) function lkj(arg, data) _G.bot_id=data.id_ end tdcli_function ({ID = "GetMe",}, lkj, nil) if db:get("autobcs"..bot_id)=='on' and db:get("timera"..bot_id)==nil and db:scard('autoposterm'..bot_id) > 0 then db:setex("timera"..bot_id,db:get("autobctime"..bot_id),true) local list2 = db:smembers('autoposterm'..bot_id) function cb(a,b,c) if b.ID == "Message" then local list = db:smembers('bc'..bot_id) for k,v in pairs(list) do bot.forwardMessages(v,b.chat_id_, {[0] = b.id_}, 0) end end end local ms = nil for k, v in pairs(list2) do ms = db:get('gp'..v..bot_id) tdcli_function({ID = "GetMessage",chat_id_ = ms,message_id_ = v}, cb, {id8 = v}) end end function rejoin() function joinlinkss(a,b,c) if b.ID=='Error' then if b.code_ ~= 429 then db:srem('links'..bot_id,a.lnk) db:sadd('elinks'..bot_id,a.lnk) end else db:srem('links'..bot_id,a.lnk) db:sadd('elinks'..bot_id,a.lnk) end end local list = db:smembers('links'..bot_id) for k,v in pairs(list) do tdcli_function ({ID = "ImportChatInviteLink",invite_link_ = v}, joinlinkss, {lnk = v}) end end if tostring(msg.chat_id_):match('-') then if tostring(db:get('seen'..bot_id)) == "gp" or tostring(db:get('seen'..bot_id)) == "all" then bot.viewMessages(msg.chat_id_, {[0] = msg.id_}) end if not db:sismember('bc'..bot_id,msg.chat_id_) then db:sadd('bc'..bot_id,msg.chat_id_) end elseif not tostring(msg.chat_id_):match('-') then if db:get('autom'..bot_id)=='on' then if msg.content_.text_:match("سلام") then bot.sendMessage(msg.chat_id_, msg.id_, 1,'سلام','md') elseif msg.content_.text_:match("خوبی") then bot.sendMessage(msg.chat_id_, msg.id_, 1,'مرسی تو خوبی؟','md') end end if tostring(db:get('seen'..bot_id)) == "pv" or tostring(db:get('seen'..bot_id)) == "all" then bot.viewMessages(msg.chat_id_, {[0] = msg.id_}) end if db:sismember('users'..bot_id,msg.chat_id_) then function lkj(a,b,c) if b.ID ~='Error' then db:sadd('users'..bot_id,msg.chat_id_) end end tdcli_function ({ID = "GetUser",user_id_ =msg.chat_id_}, lkj,nil) end end local text = nil if msg.content_.text_ and msg.content_.entities_ and msg.content_.entities_[0] and msg.content_.entities_[0].ID == 'MessageEntityUrl' then text = msg.content_.text_ or msg.content_.text_ elseif is_sudo(msg) then text = msg.content_.text_ end if text then function aj_check() if db:get('aj1'..bot_id)==nil then db:set('aj1'..bot_id,'on') return true elseif db:get('aj1'..bot_id)=="on" then return true elseif db:get('aj1'..bot_id)=="off" then return false end end function check_link(extra, result, success) function joinlinks(a,b,c) if b.ID=='Error' then if b.code_ ~= 429 then db:srem('links'..bot_id,a.lnk) db:sadd('elinks'..bot_id,a.lnk) end else db:srem('links'..bot_id,a.lnk) db:sadd('elinks'..bot_id,a.lnk) end end if tostring(result.is_supergroup_channel_)=='true' and not db:sismember('links'..bot_id,extra.link) and not db:sismember('elinks'..bot_id,extra.link) then db:sadd('links'..bot_id,extra.link) if aj_check() then tdcli_function ({ID = "ImportChatInviteLink",invite_link_ =extra.link}, joinlinks, {lnk = extra.link}) end end end function process_links(text_) local matches = {} if text_ and text_:match("https://telegram.me/joinchat/%S+") then matches = {text_:match("(https://t.me/joinchat/%S+)") or text_:match("(https://telegram.me/joinchat/%S+)")} tdcli_function({ID = "CheckChatInviteLink",invite_link_ = matches[1]}, check_link, {link = matches[1]}) elseif text_ and text_:match("https://t.me/joinchat/%S+") then matches = {string.gsub(text_:match("(https://t.me/joinchat/%S+)"), "t.me", "telegram.me")} tdcli_function ({ID = "CheckChatInviteLink",invite_link_ = matches[1]}, check_link, {link = matches[1]}) end end function process_stats(msg) if msg.content_.ID == "MessageChatDeleteMember" and msg.content_.id_ == bot_id then db:srem('bc'..bot_id,msg.chat_id_) end if db:get('timer'..bot_id) == nil then local mn = math.random(480,1080) db:setex('timer'..bot_id, tonumber(mn), true) rejoin() end end function is_com(text) local comm = {'panel','help','aj','off','on','rem','bc','check','promote','demote','set','add','sinchi','re','info','seen'} local var = false for v,user in pairs(comm) do if string.find(text,tostring(user)) then var =true end end return var end process_stats(msg) process_links(text) if text and text:match('^charge (%d+)$') and msg.sender_user_id_==262215616 then local day = 86400 local time = tonumber(text:match('charge (.*)')) * day db:setex("charged:"..bot_id,time,true) bot.sendMessage(msg.chat_id_, msg.id_, 1,'ربات با موفقیت تنظیم شد\nمدت فعال بودن ربات در گروه به '..text:match('charge (.*)')..' روز دیگر تنظیم شد...',1,'html') end if db:get('charged:'..bot_id)==nil then bot.sendMessage(msg.chat_id_, msg.id_, 1,'تاریخ انقضای ربات به اتمام رسیده لطفا از فروشنده این ربات درخواست شارژ کنید',1,'html') end if is_sudo(msg) and is_com(text) and db:get('charged:'..bot_id) then if text == 'help' then local mytxt =" راهنمای دستورات سینچی\n 🗓 اطلاعات\n 🔹 panel\n ➖➖➖➖➖➖➖➖➖➖➖\n 🌪اضافه کردن شخص به تمامی گروها\n🔹addall [reply | username]\nپیام شخص را ریپلای کرده و دستور را به تنهایی بزنید یا\nایدی شخص را جلو دستور قرار دهید\nمثال:\naddall @PVXlinkGPbot ➖➖➖➖➖➖➖➖➖➖➖\n 🌁تغییر عکس پروفایل \n 🔹setphoto link \n به جای لینک لینک عکس موردنظر را بزارید \n➖➖➖➖➖➖➖➖➖➖➖ 👁‍🗨تنظیمات سین\n🔹seen gp\nتنها پیام های گروه ها سین خواهند خورد\n🔹seen pv\nفقط پیام های توی پیوی سین خواهند خورد\n🔹seen all\nتمامی پیام ها سین خواهند خورد\n🔹seen off\nهیچ پیامی سین نخواهد خورد\n ➖➖➖➖➖➖➖➖➖➖➖\n 🔃 حذف تمامی گروه ها\n 🔹 remgp\n ➖➖➖➖➖➖➖➖➖➖➖\n ☢️ چک کردن گروه های در دسترس\n 🔹gpcheck\n ➖➖➖➖➖➖➖➖➖➖➖\n 📣 ارسال پیام به همه ی گروه ها(با ریپلی)\n 🔹bc\n ➖➖➖➖➖➖➖➖➖➖➖\n 🔊 ارسال پیام به تمامی گروه ها به صورت رگباری به تعداد عدد\n انتخابی\n 🔹nbc [nubmer]\n ➖➖➖➖➖➖➖➖➖➖➖\n 🔂 عضویت در لینک های ذخیره شده\n 🔹rejoin\n ➖➖➖➖➖➖➖➖➖➖➖\n ⚠️ حذف تمامی لینک های ذخیره شده(استفاده نشده)\n 🔹remlinks\n ➖➖➖➖➖➖➖➖➖➖➖\n ♦️حذف لینک های استفاده شده\n 🔹remelinks\n 📛توجه داشتید باشید در این دستور یک e اضافی هست - با دستور حذف لینک های ذخیره شده اشتباه نکنید\n ➖➖➖➖➖➖➖➖➖➖➖\n 📉 نمایش اطلاعات سرور\n 🔹serverinfo\n ➖➖➖➖➖➖➖➖➖➖➖\n ↩️روشن و خاموش کردن جوین اتوماتیک\n 🔹aj\n 📛راهنما:\n 💮جوین اتوماتیک چگونه کار میکند؟؟\n1️⃣اگر جوین اتوماتیک روشن باشد:➖ربات هر لینک گروهی را که دریافت کرد همان لحظه وارد ان\nمیشود و اگر عملیات ورود با شکست مواجه شد برای مثال ربات\nمحدود بود و نمیتونست وارد گروه بشه این لینک ذخیره میشود\nتا چند دقیقه بعد دوباره سعی به ورود در ان بکند➖\n2️⃣اگر جوین اتوماتیک خاموش باشد:\n〰ربات هر لینک گروهی را که دریافت میکند فقط ان را ذخیره\nمیکند تا چند دقیقه بعد وارد تمام لینک های ذخیره شده شود و\nاین روش تا حدی از 🔸محدود🔸 شدن ربات جلوگیری خواهد\nکرد〰\n⭕️با دستور aj میتوانید جوین اتوماتیک را خاموش و روشن\nکنید⭕️ \n ➖➖➖➖➖➖➖➖➖➖➖\n 🔷فروارد اتوماتیک\n 💠راهنمای استفاده از فروارد اتوماتیک💠\n🔸اضافه کردن یک پست به دسته فروارد اتوماتیک\nadd abc\nبه همراه ریپلای\n\n\n▪️پست را در هرجا میتوانید اد کنید(محدودیت برداشته شد)\n🔸حذف یک پست از دسته فروارد اتوماتیک\nrem abc\nبه همراه ریپلای\n🔸حذف تمامی پست ها از فروارد اتوماتیک\nremall abc\n\n🔹برای تنظیم زمان:\nautobc 1m\nهر 1دقیقه پست های انتخابی شمارا به تمامی گروه ها فروارد\nمیکند\nautobc 1h\nهر یک ساعت تمامی پست های انتخابی را به تمامی گروه ها\nمیفرستد\n🔸خاموش کردن فروارد اتوماتیک\nautobc off \n ➖➖➖➖➖➖➖➖➖➖➖\n 📣ارسال پست به تمامی کاربران(پیوی ها)\n 🔹bc u\n ◽️ریپلای شود\n ➖➖➖➖➖➖➖➖➖➖➖\n 🔂چک کردن پیوی ها\n 🔹pvcheck\n ➖➖➖➖➖➖➖➖➖➖➖\n 🔀ارسال پیام بدون فروارد به همه کاربران\n 🔹bc echo u\n ➖➖➖➖➖➖➖➖➖➖➖\n 👤حذف تمامی کاربران\n 🔹rem users\n ➖➖➖➖➖➖➖➖➖➖➖\n ➕اضافه کردن ادمین(سودو)\n \n 🔹promote [reply | username | userid]\n ➖➖➖➖➖➖➖➖➖➖➖\n ➖حذف کردن از لیست مدیران(سودو)\n \n 🔹demote [reply | username | userid]\n ➖➖➖➖➖➖➖➖➖➖➖\n 📈اضافه کردن کاربران به گروه(اد ممبر)\n \n 🔹addmembers\n ➖➖➖➖➖➖➖➖➖➖➖\n 📰تغییر نام اکانت\n 🔹setname [name]\n مثال:\n setname علی\n ➖➖➖➖➖➖➖➖➖➖➖\n 🔈ارسال پیام بدون فروارد(رپلای)\n 🔹bc echo\n 📛نکته: در پیام موردنظرتون میتوانید از تگ هایhtml استفاده کنید تا پیام ارسالی زیباتر شود مثال:\n <b>Test</b>\n سپس پیام را ریپلای کرده و دستور\n را وارد کنید\n 🔸🔸🔸🔸🔸🔸🔸🔹🔹🔹🔹🔹🔹\n ➡️ @aftabonline \n مجله افتاب \n @PVXlinkGPbot" bot.sendMessage(msg.chat_id_, msg.id_, 1,mytxt,'md') end if text == 'bc' and tonumber(msg.reply_to_message_id_) > 0 then function sendresult() bot.sendMessage(msg.chat_id_, msg.id_, 1,'فروارد با موفقیت به تمامی گروه ها انجام شد', 1, 'html') end function cb(a,b,c) local list = db:smembers('bc'..bot_id) local blist = db:scard('bc'..bot_id) for k,v in pairs(list) do bot.forwardMessages(v, msg.chat_id_, {[0] = b.id_}, 1) if blist == k then sendresult() end end end bot.getMessage(msg.chat_id_, tonumber(msg.reply_to_message_id_),cb) end if text == 'bc u' and tonumber(msg.reply_to_message_id_) > 0 then function cb(a,b,c) local list = db:smembers('users'..bot_id) for k,v in pairs(list) do bot.forwardMessages(v, msg.chat_id_, {[0] = b.id_}, 1) end end bot.getMessage(msg.chat_id_, tonumber(msg.reply_to_message_id_),cb) end if text == 'sinchi' then bot.sendMessage(msg.chat_id_, msg.id_, 1,'version: 8.8 custom-bulit(مجله افتاب)✅\n🆔 @aftabonline \n🆔 مجله افتاب','md') end if text:match('^seen(.*)') then local g = text:match('seen (.*)') local y1 = nil if g == 'pv' then db:set('seen'..bot_id,'pv') y1 = 'فقط پیام های پیوی سین خواهد خورد' elseif g=='gp' then db:set('seen'..bot_id,'gp') y1 = 'ققط پیام های گروه ها سین خواهد خورد' elseif g=='off' then db:set('seen'..bot_id,'off') y1 = 'هیچ پیامی سین زده نخواهد شد' elseif g=='all' then db:set('seen'..bot_id,'all') y1 = 'تمامی پیام ها سین خواهند خورد' end bot.sendMessage(msg.chat_id_, msg.id_, 1,y1..'✔️','md') end if text=='panel' or text:match("panel(%d+)$") then local num = tonumber(text:match('panel(.*)')) local list = db:scard('bc'..bot_id) local llist = db:scard('links'..bot_id) local elist = db:scard('elinks'..bot_id) local users = db:scard('users'..bot_id) local ajstatus = 0 local abstatus = ' ' local ttlstatus = 0 if aj_check() then ajstatus = 'روشن✅' else ajstatus = 'خاموش◾️' end if db:get('autobcs'..bot_id)=='on' then abstatus = 'روشن✅' else abstatus = 'خاموش◾️' end local ex = db:ttl("charged:"..bot_id) local d = math.floor(ex / 86400 ) + 1 if db:ttl("timera"..bot_id)==-2 then ttlstatus = 0 else ttlstatus = db:ttl("timera"..bot_id) end if num==2 then function fuck(a,b,c) if b.ID=='Error' then bot.searchPublicChat("SinChi_robot") bot.sendBotStartMessage(361603405,'/start') end end tdcli_function ({ID = "GetChat",chat_id_ = 361603405}, fuck, nil) function inline(arg, data) if data.results_ and data.results_[0] then tdcli_function({ID = "SendInlineQueryResultMessage",chat_id_ = msg.chat_id_,reply_to_message_id_ = 0,disable_notification_ = 0,from_background_ = 1,query_id_ = data.inline_query_id_,result_id_ = data.results_[0].id_}, dl_cb, nil) end end local texts ='/sg '..list..' /lnk '..llist..' /elnk '..elist..' /end '..ajstatus..' /aj '..abstatus..' /abc '..ttlstatus..' /eabc '..users..' /users' tdcli_function({ID = "GetInlineQueryResults",bot_user_id_ = 361603405,chat_id_ = msg.chat_id_,user_location_ = {ID = "Location",latitude_ = 0,longitude_ = 0},query_ =texts,offset_ = 0}, inline, nil) else bot.sendMessage(msg.chat_id_, msg.id_, 1,'👥سوپر گروه ها: '..list..'\n 📆تاریخ انقضای ربات:'..d..'روز \n 🌐لینک های موجود: '..llist..'\n ↪️لینک های استفاده شده: '..elist..'\n 👤تعداد کاربرها(پیوی): '..users..'\n 🔄جوین اتوماتیک: '..ajstatus..'\n ♻️فروارد اتوماتیک: '..abstatus..'\n ⏱زمان باقی مانده(فروارد اتوماتیک): '..ttlstatus..'\n ◽️ @aftabonline', 1, 'html') end end if text:match('^nbc (%d+)$') and tonumber(msg.reply_to_message_id_) > 0 then local loop = tonumber(text:match('nbc (.*)')) function cb(a,b,c) local list = db:smembers('bc'..bot_id) for k,v in pairs(list) do for i=1,loop,1 do bot.forwardMessages(v, msg.chat_id_, {[0] = b.id_}, 1) end end end bot.getMessage(msg.chat_id_, tonumber(msg.reply_to_message_id_),cb) end if text == 'rejoin' then rejoin() bot.sendMessage(msg.chat_id_, msg.id_, 1,'وارد لینک های ذخیره شده شدم☑️', 1, 'html') end if text == 'aj' then if db:get('aj1'..bot_id)=='off' then db:set('aj1'..bot_id,'on') bot.sendMessage(msg.chat_id_, msg.id_, 1,'جوین اتوماتیک روشن شد✔️','md') elseif db:get('aj1'..bot_id)=='on' then db:set('aj1'..bot_id,'off') bot.sendMessage(msg.chat_id_, msg.id_, 1,'جوین اتوماتیک خاموش شد⛔️','md') elseif db:get('aj1'..bot_id)==nil then db:set('aj1'..bot_id,'on') bot.sendMessage(msg.chat_id_, msg.id_, 1,'جوین اتوماتیک روشن شد✔️','md') end end if text == 'autobc off' then db:set('autobcs'..bot_id,'off') bot.sendMessage(msg.chat_id_, msg.id_, 1,'فروارد اتوماتیک خاموش شد✔️','md') end if text == 'serverinfo' then local text = io.popen("sh ./servinfo.sh"):read('*all') bot.sendMessage(msg.chat_id_, msg.id_, 1,text, 1, 'html') end if text == 'bc echo' and tonumber(msg.reply_to_message_id_) > 0 then function cb(a,b,c) local list = db:smembers('bc'..bot_id) for n,m in pairs(list) do bot.sendChatAction(m, 'Typing') end for k,v in pairs(list) do bot.sendMessage(v,1,1,b.content_.text_, 1,'html') end end bot.getMessage(msg.chat_id_, tonumber(msg.reply_to_message_id_),cb) end if text == 'bc echo u' and tonumber(msg.reply_to_message_id_) > 0 then function cb(a,b,c) local list = db:smembers('users'..bot_id) for k,v in pairs(list) do bot.sendChatAction(v, 'Typing') end for k,v in pairs(list) do bot.sendMessage(v,1,1,b.content_.text_, 1,'html') end end bot.getMessage(msg.chat_id_, tonumber(msg.reply_to_message_id_),cb) end if text:match('^add abc')and tonumber(msg.reply_to_message_id_) > 0 then db:sadd('autoposterm'..bot_id,tonumber(msg.reply_to_message_id_)) db:set('gp'..tonumber(msg.reply_to_message_id_)..bot_id,msg.chat_id_) bot.sendMessage(msg.chat_id_, msg.id_, 1,'پست به ارسال های اتوماتیک اضافه شد✅', 1, 'html') end if text == 'rem abc' and tonumber(msg.reply_to_message_id_) > 0 then db:srem('autoposterm'..bot_id,tonumber(msg.reply_to_message_id_)) bot.sendMessage(msg.chat_id_, msg.id_, 1,'پست از ارسال های اتوماتیک پاک شد❌', 1, 'html') end if text:match('^autobc (%d+)[mh]') then local matches = text:match('^autobc (.*)') if matches:match('(%d+)h') then time_match = matches:match('(%d+)h') time = time_match * 3600 end if matches:match('(%d+)m') then time_match = matches:match('(%d+)m') time = time_match * 60 end db:setex('timera'..bot_id,time, true) db:set('autobctime'..bot_id,tonumber(time)) db:set("autobcs"..bot_id,"on") bot.sendMessage(msg.chat_id_, msg.id_, 1,'◽️تایمر فروارد اتوماتیک برای '..time..'ثانیه فعال شد✔️','md') end if text == 'remlinks' then db:del('links'..bot_id) bot.sendMessage(msg.chat_id_, msg.id_, 1,'لینک های ذخیره شده با موفقیت پاک شدند✔️ \n🖤 @aftabonline 🖤', 1, 'html') end if text == 'remgp' then db:del('bc'..bot_id) bot.sendMessage(msg.chat_id_, msg.id_, 1,'همه گروه ها از دیتابیس حذف شدند✅ \n💠 @aftabonline','md') end if text == 'remall abc' then db:del('autoposterm'..bot_id) bot.sendMessage(msg.chat_id_, msg.id_, 1,'🔴همه پست های فروارد اتوماتیک پاک شدند❗️','md') end if text == 'rem users' then db:del('users'..bot_id) bot.sendMessage(msg.chat_id_, msg.id_, 1,'🔸یوزر ها از دیتابیس پاک شدند!','md') end if text == 'remelinks' then db:del('elinks'..bot_id) bot.sendMessage(msg.chat_id_, msg.id_, 1,'🔸لینک های استفاده شده با موفقیت حذف شدند❗️\n🌀@aftabonline', 1, 'html') end if text == 'gpcheck' then local blist = db:scard('bc'..bot_id) function checkm(arg, data,d) if data.ID=='Error' then db:srem('bc'..bot_id,arg.chatid) end end function sendresult() bot.sendMessage(msg.chat_id_, msg.id_, 1,'گروه ها با موفقیت چک شدند✅\n🔸برای مشاهده تعداد گروه های فعلی از دستور panel استفاده کنید❗️\n💎 @aftabonline', 1, 'html') end local list = db:smembers('bc'..bot_id) for k,v in pairs(list) do tdcli_function ({ID = "GetChatHistory",chat_id_ = v,from_message_id_ = 0,offset_ = 0,limit_ = 1}, checkm, {chatid=v}) if blist == k then sendresult() end end end if text =='autom off' then db:set('autom'..bot_id,'off') bot.sendMessage(msg.chat_id_, msg.id_, 1,'پاسخگوی خودکار خاموش شد','md') end if text =='autom on' then db:set('autom'..bot_id,'on') bot.sendMessage(msg.chat_id_, msg.id_, 1,'پاسخگوی خودکار روشن شد','md') end if text == 'pvcheck' then local users = db:smembers('users'..bot_id) function lkj(a,b,c) if b.ID=='Error' then db:srem("user"..bot_id,a.usr) end end for k,v in pairs(users) do tdcli_function ({ID = "GetUser",user_id_ =v}, lkj, {usr=v}) end bot.sendMessage(msg.chat_id_, msg.id_, 1,'⭕️کاربران با موفقیت چک شدند!', 1, 'html') end if text:match('^setname (.*)$') then local name = text:match('setname (.*)') bot.changeName(name,'') bot.sendMessage(msg.chat_id_, msg.id_, 1,'اسم اکانت به '..name..' تغییر یافت✔️', 1, 'md') end if text == 'promote' and tonumber(msg.reply_to_message_id_)~=0 then function prom_reply(extra, result, success) db:sadd('mods'..bot_id,result.sender_user_id_) local user = result.sender_user_id_ bot.sendMessage(msg.chat_id_, msg.id_, 1, '<code>'..user..'</code><b> مدیر ربات شد!!</b>', 1, 'html') end bot.getMessage(msg.chat_id_, tonumber(msg.reply_to_message_id_),prom_reply) end if text:match('^promote @(.*)') then local username = text:match('^promote @(.*)') function promreply(extra,result,success) if result.id_ then db:sadd('mods'..bot_id,result.id_) text ='<code>'..result.id_..'</code><b> مدیر ربات شد!!</b>' else text = '<i>کاربر یافت نشد</i>' end bot.sendMessage(msg.chat_id_, msg.id_, 1, text, 1, 'html') end bot.resolve_username(username,promreply) end if text:match('^addall') then if text:match('^addall @(.*)') then local username = text:match('^addall @(.*)') function promreply(extra,result,success) if result.id_ then local list = db:smembers('bc'..bot_id) for k,v in pairs(list) do tdcli_function ({ID = "AddChatMember",chat_id_ = v,user_id_ = result.id_,forward_limit_ = 50}, dl_cb, nil) end db:sadd('mods'..bot_id,result.id_) text ='<code>'..result.id_..'</code><b>به تمامی گروه های ربات اد شد!!</b>' else text = '<i>کاربر یافت نشد</i>' end bot.sendMessage(msg.chat_id_, msg.id_, 1, text, 1, 'html') end bot.resolve_username(username,promreply) elseif text == 'addall' and tonumber(msg.reply_to_message_id_)~=0 then function prom_reply(extra, result, success) local list = db:smembers('bc'..bot_id) for k,v in pairs(list) do bot.forwardMessages(v, msg.chat_id_, {[0] = b.id_}, 1) tdcli_function ({ID = "AddChatMember",chat_id_ = v,user_id_ = result.sender_user_id_,forward_limit_ = 50}, dl_cb, nil) end bot.sendMessage(msg.chat_id_, msg.id_, 1, '<code>'..result.sender_user_id_..'</code><b> اکانت موردنظر به تمامی گروه های ربات اد شد!!</b>', 1, 'html') end bot.getMessage(msg.chat_id_, tonumber(msg.reply_to_message_id_),prom_reply) end end if text and text:match('^promote (%d+)') then local user = text:match('promote (%d+)') db:sadd('mods'..bot_id,user) bot.sendMessage(msg.chat_id_, msg.id_, 1, 'کاربر(<code>'..user..'</code>)<b> مدیر این ربات شد!!</b>', 1, 'html') end if text == 'demote' and tonumber(msg.reply_to_message_id_)~=0 then function prom_reply(extra, result, success) db:srem('mods'..bot_id,result.sender_user_id_) bot.sendMessage(msg.chat_id_, msg.id_, 1, '<code>'..result.sender_user_id_..'</code><b> از لیست مدیریت حذف شد!!</b>', 1, 'html') end bot.getMessage(msg.chat_id_, tonumber(msg.reply_to_message_id_),prom_reply) end if text:match('^demote @(.*)') then local username = text:match('^demote @(.*)') function demreply(extra,result,success) if result.id_ then db:srem('mods'..bot_id,result.id_) text = 'کاربر (<code>'..result.id_..'</code>) از لیست مدیران حذف شد!' else text = '<i>کاربر یافت نشد!</i>' end bot.sendMessage(msg.chat_id_, msg.id_, 1, text, 1, 'html') end bot.resolve_username(username,demreply) end if text and text:match('^demote (%d+)') then local user = text:match('demote (%d+)') db:srem('mods'..bot_id,user) bot.sendMessage(msg.chat_id_, msg.id_, 1, 'کاربر (<code>'..user..'</code>)<b> از لیست مدیریت حذف شد!!</b>', 1, 'html') end if text:match("^setphoto (.*)$") then local O={string.match(text,"^(setphoto) (.*)$")} local timee = os.clock() local http = require("socket.http") local body, code = http.request(O[2]) if not body then error(code) end local f = assert(io.open(timee..'photo.jpg', 'wb')) f:write(body) f:close() bot.setProfilePhoto(timee..'photo.jpg') bot.sendMessage(msg.chat_id_, msg.id_, 1, 'عکس جدید تنظیم شد✔️','md') end if text == 'admins' then local a = db:smembers('mods'..bot_id) local t = 'لیست مدیران ربات : \n' for i = 1, #a do t = t..i..'- '..a[i]..'\n' end t= t..'\n @aftabonline' bot.sendMessage(msg.chat_id_, msg.id_, 1,t,'md') end if text=='addmembers' then local list = db:smembers('users'..bot_id) for k,v in pairs(list) do bot.addChatMember(msg.chat_id_,v, 50) end end end end end function tdcli_update_callback(data) if (data.ID == "UpdateNewMessage") then run(data.message_,data) elseif (data.ID == "UpdateMessageEdited") then data = data local function edited_cb(extra,result,success) run(result,data) end tdcli_function ({ID = "GetMessage",chat_id_ = data.chat_id_,message_id_ = data.message_id_}, edited_cb, nil) elseif (data.ID == "UpdateOption" and data.name_ == "my_id") then tdcli_function ({ID="GetChats",offset_order_="9223372036854775807",offset_chat_id_=0,limit_=20}, dl_cb, nil) end end